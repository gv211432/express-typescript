<link
  rel="stylesheet"
  href="Modal_jQuery/css/jquery.popup.css"
  type="text/css"
/>

<script
  type="text/javascript"
  src="Modal_jQuery/js/jquery-2.0.3.min.js"
></script>

<script type="text/javascript" src="Modal_jQuery/js/jquery.popup.js"></script>

<script src="Modal_jQuery/image-picker/image-picker.js"></script>

<script type="text/javascript">
  $(function () {
    $(".js__p_start, .js__p_another_start").simplePopup();
  });
</script>

<link
  href="https://www.jqueryscript.net/css/jquerysctipttop.css"
  rel="stylesheet"
  type="text/css"
/>
<link
  href="Modal_jQuery/image-picker/image-picker.css"
  rel="stylesheet"
  type="text/css"
/>

<script>
  // window.onbeforeunload = function () {
  //   return "Refreshing might break the site..";
  // };

  function say() {
    console.log("Saying......");
  }

  $(function () {
    function uiFix() {
      if ($(window).width() <= 700) {
        console.log("changing flex");
        $("#img-info-container").css({
          display: "flex",
          "flex-direction": "column",
          "overflow-x": "hidden",
          "overflow-y": "scroll",
        });

        $("#infoWindow").css({
          "min-height": "150px",
          width: "100%",
          "background-color": "pink",
          "z-index": 1,
          "border-top": "1px solid black",
          "overflow-x": "hidden",
          "overflow-y": "scroll",
          padding: "5px",
        });

        $("#imgWindow").css({
          "margin-top": "-70px",
          "padding-right": "0px",
          "overflow-y": "scroll",
          "overflow-x": "hidden",
        });
      }
    }

    uiFix();
    $(window).resize(function () {
      // This will execute whenever the window is resized
      // $(window).height(); // New height
      // $(window).width(); // New width
      // console.log("Window Height " + $(window).height());
      // console.log("Window width " + $(window).width());
      uiFix();
    });

    let toRender = true;
    $("#clickMe").on("click", function () {
      if (toRender) {
        toRender = false;
        let myImgPlace = $("#imgHolder");
        let namePlace = $("#nameHolder");

        let xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
            if (xhr.status == 200) {
              console.log(xhr.responseText);
              let jsonData = JSON.parse(xhr.responseText);
              let dataArr = jsonData.urls;
              // console.log(dataArr);
              dataArr.forEach(function (element, index) {
                console.log(element);
                let myImgClone = myImgPlace
                  .clone()
                  .attr("id", "img-c" + index)
                  .attr("img-id", "img" + index)
                  .attr("value", index)
                  .attr("data-img-alt", "alt" + index)
                  .attr("data-img-src", element.formats.thumbnail.url)
                  .text(element.name);

                myImgPlace.before(myImgClone);
              });

              // myImgPlace.hide();
              $(".image-picker").imagepicker({
                hide_select: true,
              });

              $(".image_picker_image").click(function (e) {
                console.log("Hi bro");
                let ar = this.getAttribute("alt");
                let index = ar.slice(3);
                // console.log(ar);
                // console.log(index);
                namePlace.text(dataArr[index].name);

                $("#info-name").text(dataArr[index].name);
                $("#info-url").text(dataArr[index].url);
                $("#info-type").text(dataArr[index].mime);
                $("#info-height").text(dataArr[index].height);
                $("#info-width").text(dataArr[index].width);
                $("#info-size").text(dataArr[index].size + "kb");

                // dataArr.forEach(function (element, index) {});
              });
            }
          }
        };

        xhr.open("GET", "/img?mode=gallery");
        xhr.send();

        console.log("Script is loaded..");
      }
    });
  });
</script>
